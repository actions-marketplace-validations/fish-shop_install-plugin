name: 'fish-shop/install-plugin'
description: 'A GitHub action for installing fish shell plugins'
branding:
  icon: 'arrow-down'
  color: 'blue'
inputs:
  plugin-manager:
    description: 'The name of the fish shell plugin manager to use'
  plugins:
    description: 'The plugin(s) to install; this value is passed verbatim as an argument to the install command of the chosen plugin manager and the values supported may differ between tools'
runs:
  using: 'composite'
  steps:
    - name: Install plugins
      run: |
        set -l plugin_manager ${{ inputs.plugin-manager }}
        switch $plugin_manager
            case 'fisher'
                if test (type -q fisher) $status -ne 0
                    curl -sL https://git.io/fisher | source && fisher install jorgebucaran/fisher
                end
                fisher install ${{ inputs.plugins }}
            case 'oh-my-fish'
                if test (type -q omf) $status -ne 0
                    curl -L https://get.oh-my.fish > omf-install
                    chmod u+x omf-install
                    ./omf-install -y --noninteractive
                    source ~/.config/fish/conf.d/omf.fish
                end
                omf install ${{ inputs.plugins }}
            case 'plug.fish'
                if test (type -q plug) $status -ne 0
                    curl -sSL https://git.io/fish-plug | source && plug install kidonng/fish-plug
                end
                plug install ${{ inputs.plugins }}
            case '*'
                echo "Unrecognised plugin manager: '$plugin_manager'" >&2; and exit 1
        end
      shell: fish {0}
